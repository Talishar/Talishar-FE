const axios = require('axios');
const fs = require('fs');

const url = "https://raw.githubusercontent.com/the-fab-cube/flesh-and-blood-cards/refs/heads/compendium-of-rathe/json/english/card.json";

const outputFile = '../src/constants/cardList.ts';

axios
  .get(url)
  .then((response) => {
    const cards = response.data;

    console.log(`Total cards fetched: ${cards.length}`);

    const cardNames = cards.reduce((acc, card) => {
      const name = card.name.trim();

      if (card.types.includes('Token')) {
        return acc;
      }

      // if name has "//" split into two names
      if (name.includes("//")) {
        const [name1, name2] = name.split("//");
        if (!acc.includes(name1.trim())) {
          acc.push(name1.trim());
        }
        if (!acc.includes(name2.trim())) {
          acc.push(name2.trim());
        }
        return acc;
      }

      if (!acc.includes(name)) {
        acc.push(name);
      }

      return acc;
    }, []);

    const sortedCardNames = cardNames.sort();

    console.log(`Unique cards found: ${sortedCardNames.length}`);

    const exportData = `// This file is generated by the card-generator script. Do not edit it manually. \nexport const CARD_LIST: string[] = ${JSON.stringify(
      sortedCardNames,
      null,
      2
    )};`;

    fs.mkdirSync('../src/constants', { recursive: true }); // create the constants directory if it doesn't exist
    fs.writeFileSync(outputFile, exportData);
    console.log(`Card list written to ${outputFile}`);
  })
  .catch((err) => {
    console.error('Error fetching or processing cards:');
    console.error(err.message);
    if (err.response) {
      console.error(`Status: ${err.response.status}`);
      console.error(`Data: ${err.response.data}`);
    }
  });
